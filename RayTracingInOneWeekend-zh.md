# Ray Tracing In One Weekend

Rray Tracing Series by Peter Shirley

# 1. 概览
这些年来我教过很多图形课。我经常在光线追踪中这样做，因为你被迫编写所有代码，但你仍然可以在没有 API 的情况下获得很酷的图像。

我决定将我的课程笔记改编成一个操作方法，让你尽快进入一个很酷的程序。它不会是功能齐全的光线追踪器，但它确实具有间接照明，这使光线追踪成为电影中的主要内容。遵循这些步骤，如果您兴奋并想要追求它，您生产的光线追踪器的架构将有利于扩展到更广泛的光线追踪器。

当有人说“光线追踪”时，它可能意味着很多事情。我要描述的是技术上的路径跟踪器，而且是一个相当通用的跟踪器。虽然代码会非常简单（让计算机来完成工作！）但我认为您会对您制作的图像感到非常满意。

我将按照我编写的顺序向您介绍如何编写光线追踪器，以及一些调试技巧。到最后，您将拥有一个可以生成一些出色图像的光线追踪器。您应该可以在周末完成此操作。如果您需要更长的时间，请不要担心。我使用 C++ 作为驱动语言，但你不需要。但是，我建议您这样做，因为它速度快、便携，而且大多数制作电影和视频游戏渲染器都是用 C++ 编写的。请注意，我避免了 C++ 的大多数“现代特性”，但是继承和运算符重载对于光线追踪器来说太有用了，无法传递。我没有在线提供代码，但代码是真实的，除了 vec3 类中的几个简单运算符外，我展示了所有代码。我非常相信通过输入代码来学习它，但是当代码可用时我会使用它，所以我只在代码不可用时练习我所宣扬的内容。

所以不要问！我留下了最后一部分，因为我做的 180 度很有趣。一些读者最终遇到了细微的错误，这些错误在我们比较代码时得到了帮助。所以请输入代码，但如果你想查看我的代码，它位于
https://github.com/RayTracing/raytracing.github.io/

我假设读者对向量有一点熟悉（比如点积和向量加法）。如果您不知道，请进行一定的复习。如果您需要复习，或者第一次学习它，请查看 Marschner 和我的图形书籍，Foley、Van Dam 等，或 McGuire 的图形法典。

如果你遇到了麻烦，或者做了一些很酷的事情，你想让别人看看，给我发电子邮件：[ptrshrl@gmail.com](ptrshrl@gmail.com).


我将维护一个与本书相关的网站，包括进一步阅读和博客资源链接。
https://in1weekend.blogspot.com/

感谢所有帮助这个项目的人。您可以在这本书的结尾。

让我们继续吧！



# 2. 输出PPM格式的图片

## 2.1. PPM 格式图片
无论何时启动渲染器，都需要一种查看图像的方法。最直接的方法是将其写入文件。问题是，格式太多了。其中许多是复杂的。我总是从纯文本ppm文件开始。下面是维基百科关于PPM的一个很好的描述：

![ppmExample](images/ppmExample.png)  


让我们制作一些C++代码来输出这样的东西
```cpp
#include <iostream>

int main() {
    // Image
    const int image_width = 256;
    const int image_height = 256;
    // Render.
    std::cout << "P3\n" << image_width << ' ' << image_height << "\n255\n";
    for (int j = image_height-1; j >= 0; --j) {
        for (int i = 0; i < image_width; ++i) {
            auto r = double(i) / (image_width-1);
            auto g = double(j) / (image_height-1);
            auto b = 0.25;
            int ir = static_cast<int>(255.999 * r);
            int ig = static_cast<int>(255.999 * g);
            int ib = static_cast<int>(255.999 * b);
            std::cout << ir << ' ' << ig << ' ' << ib << '\n';
        }
    }
}
 ```
该代码中需要注意一些事项：
1. 像素按从左到右的像素行写出。
2. 从上到下写出行。
3. 按照惯例，每个红色/绿色/蓝色分量的范围从0.0到1.0。稍后我们将对此进行放宽当我们在内部使用高动态范围时，但在输出前，我们将色调映射到0到1范围，因此此代码不会更改。
4. 从左到右，红色从完全关闭（黑色）变为完全打开（鲜红色），绿色从黑色变为黑色从底部到顶部完全打开。红色和绿色一起变成黄色，所以我们应该期待鞋面右角为黄色


## 2.2. 创建图像文件
由于文件被写入程序输出，因此需要将其重定向到图像文件。通常，这是通过使用>重定向运算符从命令行完成的，如下所示：

```c
build\Release\inOneWeekend.exe > image.ppm
```
在Mac或者Linux下可能是这样的：
```c
build/inOneWeekend.exe > image.ppm
```

使用PPM图片阅读器打开来预览图片信息。（这里推荐在线软件）